# This workflow integrates Qwiet preZero with GitHub
# Visit https://docs.shiftleft.io for help
name: Qwiet

on:
  pull_request:
  workflow_dispatch:
  push:
    # We recommend triggering a scan when merging to your default branch
    # as a best practice, especially if you'd like to compare the results
    # of two scans (e.g., a feature branch against the default branch)
    branches:
      - main
      - master
jobs:
  ngsast-build:
    runs-on: ubuntu-20.04
    steps:
    - name: Install U Deps
      run: sudo apt-get install build-essential cmake pkg-config libicu-dev zlib1g-dev libcurl4-openssl-dev libssl-dev ruby-dev
      
    - name: Download the Qwiet CLI and set permissions
      run: |
        curl https://cdn.shiftleft.io/download/sl > ${GITHUB_WORKSPACE}/sl && chmod a+rx ${GITHUB_WORKSPACE}/sl

    # Qwiet requires Java 1.8
    - name: Set up Java
      uses: actions/setup-java@v1.4.3
      with:
        java-version: 1.8

    #- uses: actions/checkout@v4
    #- uses: ruby/setup-ruby@ec02537da5712d66d4d50a0f33b7eb52773b5ed1
      #with:
        #ruby-version: '3.2.1' # Not needed with a .ruby-version file
    #- run: gem install github-linguist
    #- run: bundle install
    #- run: bundle exec rake
    
    #- name: Install dependencies
    #  run: |
        #pip install -r requirements.txt
        #python3 -m pip install tensorflow[and-cuda]
        #pip install --upgrade pip
        #pip3 install --upgrade tensorflow-2.5.0
    #- name: Docker Run
    #  run: docker run --rm -v $(pwd):$(pwd) -w $(pwd) -t enjoyelan/qwiet_linguist:latest github-linguist .
    - name: Analyze application with Qwiet
      run: ${GITHUB_WORKSPACE}/sl analyze --app JuiceShop --tag branch=${{ github.head_ref || steps.extract_branch.outputs.branch }} --jssrc $(pwd) --package-json package.json
      #run: python shiftleftmulti.py
      #$run: guesslang .
      #run: github-linguist > languages.txt
    #- name: Analyze application with Qwiet2   
      #run: python shiftleftmulti2.py
      #shell: sh
      env:
        SHIFTLEFT_ACCESS_TOKEN: ${{ secrets.SHIFTLEFT_ACCESS_TOKEN1 }}
